<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Safe Driving Score | Automatic Labs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:title" content="Safe Driving Score | Automatic"/>
    <meta property="og:image" content="/labs/battery/img/safe_driving_score.png"/>
    <meta property="og:site_name" content="Automatic"/>
    <meta property="og:description" content="Analysis of my driving."/>

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@automatic">
    <meta name="twitter:title" content="Safe Driving Score| Automatic">
    <meta name="twitter:description" content="Analysis of my driving.">
    <meta name="twitter:image" content="/labs/battery/img/safe_driving_score.png">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="../common/css/style.css" rel="stylesheet" />
    <link href="css/safe_driving_score.css" rel="stylesheet" />

  </head>
  <body>
    <a class="btn-logout" href="/#/logout">Log out</a>
    <div class="loading">
      <div class="title">Loading...</div>
      <div class="progress"></div>
    </div>
    <div class="container" id="container">
      <div class="row">
        <div class="col mt-2">
          <h1 class="labs-title">Safe Driving Score</h1>
          <div class="labs-tagline">By Automatic Labs</div>
          <div class="alert alert-warning alert-demo mt-3">This is sample data from a demo account. <a class="login-link" href="#">Log in</a> to view your Automatic driving history.</div>

          <div class="controls hidden mb-3" id="controls">
            Vehicle:
            <select id="vehicleChoice"></select>
          </div>

          <div id="noData" class="hidden alert alert-warning">
            <p>Safe Driver Score requires a Pro adapter and a minimum of 5 miles a week of driving for 12 weeks. Check back once you have gone for a few drives to get an update.</p>
            <a href="?demo" class="btn btn-blue">View Demo Data</a>
          </div>

          <div id="error" class="hidden alert alert-danger">Error: Unable to fetch data</div>
        </div>
      </div>
      <div id="results" class="results hidden">
        <div class="row">
          <div class="col">
            <h2>Driving Score</h2>
          </div>
        </div>
        <div class="row">
          <div id="scoreGraph" class="score-graph col-md-4 text-center"></div>
          <div id="scoreResults" class="col-md-8 mb-3"></div>
        </div>
        <div id="scoreComponents" class="score-components row"></div>
        <div id="scoreHistory" class="score-history row">
          <div class="col-md-12 mt-4">
            <h2>Score History</h2>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div id="scoreHistoryGraph" class="score-history-graphn pt-3"></div>
            <h2>What makes a Safe Driver Score?</h2>
            <p>Your driver score is our way of figuring out the best way to help you drive more efficiently. Our platform examines driving behavior, driving habits, and external factors like weather and traffic, then offers feedback to improve your driving.</p>
          </div>
        </div>
      </div>
    </div>

    <a href="/#/labs" class="automatic-labs" title="Back to Automatic Labs Home">Labs</a>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js" integrity="sha256-7/yoZS3548fXSRXqc/xYzjsmuW3sFKzuvOCHd06Pmps=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@5.7.0/dist/d3.min.js" integrity="sha256-va1Vhe+all/yVFhzgwmwBgWMVfLHjXlNJfvsrjUBRgk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>

    <script src="../common/js/main.js"></script>

    <script src="./js/safeDrivingScore.js"></script>

    <script>
      function getData(vehicleId) {
        clearData();
        getDrivingScore($('#vehicleChoice').val(), renderDrivingScore);
        getDrivingScoreHistory($('#vehicleChoice').val(), renderDrivingScoreHistory);
      }

      function clearData() {
        var node = d3.select('#scoreGraph');
        node.select('svg').remove();

        var historyNode = d3.select('#scoreHistoryGraph');
        historyNode.select('svg').remove();

        $('#scoreResults, #scoreComponents').empty();
      }

      /* On Page Load */
      formatForDemo();
      showLoginLink('safe_driving_score');

      var queryParams = getQueryParams(document.location.search);

      showLoading();

      fetchVehicles(function(results) {
        if (results.length === 0) {
          // error occurred or user has no vehicles
          alert('No Vehicles Found');
        } else {
          _.sortBy(results, 'make').forEach(function(vehicle) {
            var vehicleName = vehicle.year + ' ' + vehicle.make + ' ' + vehicle.model;
            $('#vehicleChoice').append('<option value="' + vehicle.id + '">' + vehicleName  + '</option>');
          });

          $('#controls').show();
        }

        getData($('#vehicleChoice').val());
      });

      $('#vehicleChoice').change(function() { getData($('#vehicleChoice').val()) });

    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-33317148-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
