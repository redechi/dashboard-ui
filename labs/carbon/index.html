<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Carbon Calculator | Automatic Labs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.css" rel="stylesheet" />
    <link href="../common/css/style.css" rel="stylesheet" />
    <style>
      .wrapper {
        width: 700px;
        margin: 0 auto;
        datalist
      }

      .calculations {
        display: none;
        line-height: 40px;
      }

      .calculations p span {
        padding: 8px;
        background: #f9e458;
      }

      .notes {
        margin-top: 30px;
        background: #eee;
        font-size: 12px;
        padding: 10px 15px;
        line-height: 20px;
      }

      .controls {
        background: #eee;
        margin-bottom: 40px;
        padding: 10px 15px;
      }
    </style>
  </head>
  <body>
    <div class="loading">Loading...</div>
    <div class="wrapper">
      <h1>Carbon Calculator</h1>
      <div class="controls">
        Fuel Type:
        <select class="fuelType">
          <option value="19.64">Gasoline</option>
          <option value="22.38">Diesel</option>
          <option value="17.9">Biodiesel</option>
        </select>
      </div>
      <div class="calculations">
        <p>In the last <span class="months"></span> months of driving, you drove <span class="miles"></span> miles on <span class="trips"></span> trips.</p>
        <p>This used <span class="gallons"></span> gallons of gasoline which resulted in <span class="pounds"></span> pounds of CO<sub>2</sub> emissions.</p>

        <div class="notes">
          This is based on an estimate of <span class="epaRate"></span> lbs CO<sub>2</sub>/gallon of gasoline.  This value assumes that all the carbon in the gasoline is converted to CO<sub>2</sub>.<br>
          Sources: <a href="http://www.epa.gov/cleanenergy/energy-resources/refs.html">EPA</a> and <a href="http://www.eia.gov/tools/faqs/faq.cfm?id=307&t=11">U.S. Energy Information Administration</a>
        </div>
      </div>
    </div>
    <a href="#labs" class="automatic-labs">Labs</a>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.js"></script>
    <script src="../common/js/main.js"></script>

    <script>
      var trips = [];

      function gallonsTolbsCO2(g) {
        return g * $('.fuelType').val();
      }

      function calculate() {
        var stats = trips.reduce(function(memo, trip) {
          memo.distance_m += trip.distance_m;
          memo.fuel_volume_l += trip.fuel_volume_l
          return memo;
        }, {fuel_volume_l: 0, distance_m: 0});

        var totalDistanceMiles = metersToMiles(stats.distance_m);
        var totalFuelGallons = litersToGallons(stats.fuel_volume_l);
        var totalCO2Pounds = gallonsTolbsCO2(totalFuelGallons);

        var months = moment().diff(moment(trips.slice(-1)[0].started_at), 'months');

        $('.calculations').show();

        $('.months').text(months);
        $('.trips').text(trips.length);
        $('.miles').text(formatNumber(totalDistanceMiles.toFixed(1)));
        $('.gallons').text(totalFuelGallons.toFixed(1));
        $('.pounds').text(formatNumber(totalCO2Pounds.toFixed(0)));

        $('.epaRate').text($('.fuelType').val());
      }

      fetchTrips(function(results) {
        trips = results;

        if(!trips.length) {
          $('.calculations').text('You have not taken any trips yet').show();
        }

        calculate();
      });

      $('.fuelType').change(calculate);
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-33317148-4', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
